services:
  dns:
    build:
      context: https://github.com/veka-server/docker-dns.git#main
    container_name: dns
    ports:
      - "53:53/udp"
      - "53:53/tcp"
    networks:
      - custom-network
    restart: unless-stopped
    labels:
      - "homepage.group=Network"
      - "homepage.name=DNS"
      - "homepage.icon=/icons/dns.png"
      - "homepage.description=Serveur DNS principal"

  dnsrelay:
    image: 4km3/dnsmasq:latest
    container_name: dnsrelay
    command:
      - --no-daemon
      - --log-queries
      - --server=192.168.1.182
      - --listen-address=0.0.0.0
      - --bind-interfaces
      - --address=/.loc.ovh/172.125.0.12
    restart: unless-stopped
    networks:
      internal-fixed:
        ipv4_address: 172.125.0.11
      custom-network:
    labels:
      - "homepage.group=Network"
      - "homepage.name=DNS Relay"
      - "homepage.icon=/icons/dns.png"
      - "homepage.description=Relais DNS Dnsmasq pour les navigateurs interne"


  nginx-reverse-proxy:
    image: ghcr.io/veka-server/docker-nginx-reverse-proxy:latest
    container_name: nginx-reverse-proxy
#    ports:
#      - "80:80"
#      - "443:443"
    volumes:
      - ${ROOT_PATH}/nginx-ssl:/etc/nginx/ssl
      - ${ROOT_PATH}/nginx-htpasswd:/etc/nginx/.htpasswd:ro
    restart: unless-stopped
    networks:
      internal-fixed:
        ipv4_address: 172.125.0.12
      no-internet:
      custom-network:
    labels:
      - "homepage.group=Network"
      - "homepage.name=Nginx Reverse Proxy"
      - "homepage.icon=nginx.png"
      - "homepage.href=https://hub.loc.ovh"
      - "homepage.description=Serveur web Nginx"
      - "homepage.weight=2"


  traefik:
    image: traefik:latest
    container_name: traefik
    ports:
      - "80:80"
      - "443:443"
      - "8080:8080"  # Dashboard Traefik
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./config-traefik/traefik.yml:/traefik.yml:ro
      - ./config-traefik/dynamic.yml:/dynamic.yml:ro
#      - ${ROOT_PATH}/traefik/acme.json:/acme.json
      - ${ROOT_PATH}/traefik/certs:/certs
    networks:
      - custom-network
      - no-internet
    env_file:
      - ../../.env
    restart: unless-stopped
    labels:
      - "homepage.group=Network"
      - "homepage.name=Traefik"
      - "homepage.icon=traefik.png"
      - "homepage.href=http://traefik.loc.ovh"
      - "homepage.description=Reverse Proxy et Load Balancer"

  tor:
    image: ghcr.io/veka-server/docker-tor-proxy:latest
    container_name: tor
    restart: always
    networks:
      custom-network:
      no-internet:
    labels:
      - "homepage.group=Network"
      - "homepage.name=Tor Proxy"
      - "homepage.icon=tor.png"
      - "homepage.description=Proxy Tor anonyme"

  hyphanet:
    container_name: hyphanet
    build:
      context: https://github.com/PoulLorca/hyphanet-docker.git#main
      args:
        HYPHANET_VERSION: "1503"
    restart: always
    volumes:
      - hyphanet_data:/data
    networks:
      - custom-network
    labels:
      - "homepage.group=Network"
      - "homepage.name=Hyphanet"
      - "homepage.icon=/icons/hyphanet.png"
      - "homepage.description=RÃ©seau P2P Hyphanet"

volumes:
  hyphanet_data:
